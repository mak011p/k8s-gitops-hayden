---
apiVersion: v1
kind: ConfigMap
metadata:
  name: odoo-config
  namespace: business-system
data:
  odoo.conf: |
    [options]
    # PgBouncer pooler for connection efficiency (transaction mode)
    # LISTEN/NOTIFY (used by queue_job and bus) bypasses PgBouncer via dedicated settings below
    db_host = odoo-pg-pooler.business-system.svc.cluster.local
    db_port = 5432

    # Direct PG connection for bus longpolling (LISTEN/NOTIFY incompatible with PgBouncer transaction mode)
    imdispatcher_db_host = odoo-pg-rw.business-system.svc.cluster.local
    imdispatcher_db_port = 5432
    db_template = template0
    import_limit = 25000

    # Server settings
    http_port = 8069
    xmlrpc_port = 8071
    gevent_port = 8072

    # Addons paths
    addons_path = /usr/lib/python3/dist-packages/odoo/addons,/mnt/extra-addons/custom,/mnt/extra-addons/vendor-oca,/mnt/extra-addons/vendor-ventor,/mnt/enterprise-addons

    # Data directory
    data_dir = /var/lib/odoo

    # Server-wide modules (queue_job enables background job processing)
    server_wide_modules = base,web,queue_job,bus_alt_connection

    # Log settings
    log_level = info
    log_handler = :INFO

    # Performance settings
    workers = 6
    worker_class = gevent
    max_cron_threads = 2
    limit_memory_hard = 5368709120
    limit_memory_soft = 4294967296
    limit_request = 8192
    limit_time_cpu = 600
    limit_time_real = 2400
    limit_time_real_cron = 3600

    # Deployment settings
    proxy_mode = True
    list_db = False

    # Queue Job Configuration
    [queue_job]
    channels = root:6,root.sale_order:4,root.product_template:2,root.inventory:2
    # Direct PG connection for jobrunner (LISTEN/NOTIFY incompatible with PgBouncer transaction mode)
    jobrunner_db_host = odoo-pg-rw.business-system.svc.cluster.local
    jobrunner_db_port = 5432
