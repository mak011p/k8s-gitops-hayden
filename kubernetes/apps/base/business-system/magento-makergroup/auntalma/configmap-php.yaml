---
apiVersion: v1
kind: ConfigMap
metadata:
  name: auntalma-php-config
  namespace: business-system
data:
  php.ini: |
    memory_limit = 4G
    max_execution_time = 1800
    zlib.output_compression = On
    cgi.fix_pathinfo = 0
    date.timezone = Australia/Melbourne

    ; Session settings
    session.auto_start = Off
    session.use_cookies = 1
    session.use_only_cookies = 1
    session.cookie_httponly = 1

    ; OPcache settings
    opcache.enable = 1
    opcache.enable_cli = 1
    opcache.memory_consumption = 512
    opcache.interned_strings_buffer = 16
    opcache.max_accelerated_files = 100000
    opcache.validate_timestamps = 0
    opcache.save_comments = 1
    opcache.enable_file_override = 1

    ; Realpath cache
    realpath_cache_size = 10M
    realpath_cache_ttl = 7200
  www.conf: |
    [www]
    user = www-data
    group = www-data
    listen = 127.0.0.1:9000
    listen.owner = www-data
    listen.group = www-data

    pm = dynamic
    pm.max_children = 50
    pm.start_servers = 5
    pm.min_spare_servers = 5
    pm.max_spare_servers = 35
    pm.max_requests = 500

    ; Status page for health checks
    pm.status_path = /status
    ping.path = /ping
    ping.response = pong

    ; Slow log for debugging
    slowlog = /proc/self/fd/2
    request_slowlog_timeout = 10s

    ; Security
    security.limit_extensions = .php

    ; Environment variables
    clear_env = no
