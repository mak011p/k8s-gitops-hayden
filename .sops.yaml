---
# creation rules are evaluated sequentially, the first match wins
creation_rules:
  # ============================================
  # KIND Local Development (Age-only, no GCP KMS)
  # ============================================
  # KIND-local secrets use a separate development Age key
  # Generate your dev key with: task kind:age-keygen
  # Then replace DEV_AGE_PUBLIC_KEY below with your actual public key
  - path_regex: kubernetes/clusters/kind-local/secrets/.*\.enc\.age\.ya?ml$
    encrypted_regex: ^(data|stringData)$
    unencrypted-regex: ^(description|metadata)$
    # IMPORTANT: Replace this with your dev Age public key from ~/.config/sops/age/keys-dev.txt
    # Run 'task kind:age-keygen' to generate, then copy the public key here
    age: age17xkx8ed9xl6pmtaq0vh4l68fyzjeylpx74rfuj47nq3xvr74p32quz0p7u
    mac_only_encrypted: true

  # ============================================
  # Production GCP KMS encryption rules
  # ============================================
  # PGP key file - encrypted with GCP KMS only (so PGP private key can be stored in Git)
  - path_regex: kubernetes/clusters/.*/secrets/sops-gpg.encrypted.ya?ml
    encrypted_regex: ^(data|stringData)$
    unencrypted-regex: ^(description|metadata)$
    gcp_kms: projects/hayden-agencies-infra/locations/global/keyRings/sops/cryptoKeys/sops-key
    mac_only_encrypted: true
  # Age key file - encrypted with GCP KMS only (so Age private key can be stored in Git)
  - path_regex: kubernetes/clusters/.*/secrets/sops-age.encrypted.ya?ml
    encrypted_regex: ^(data|stringData)$
    unencrypted-regex: ^(description|metadata)$
    gcp_kms: projects/hayden-agencies-infra/locations/global/keyRings/sops/cryptoKeys/sops-key
    mac_only_encrypted: true

  # ============================================
  # Age-only encryption rules (.enc.age.yaml)
  # ============================================
  # Kubernetes secret files - Age only
  - path_regex: kubernetes/.*\.enc\.age\.ya?ml$
    encrypted_regex: ^(data|stringData)$
    unencrypted-regex: ^(description|metadata)$
    age: age1ha5rkmrmdgd079xkvlp3svelhgd3wxm9l0v88es7hjp6ujcvnyjsxxrc7h
    mac_only_encrypted: true
  # Talos secret files - Age only
  - path_regex: talos/.*/.*\.enc\.age\.ya?ml$
    age: age1ha5rkmrmdgd079xkvlp3svelhgd3wxm9l0v88es7hjp6ujcvnyjsxxrc7h
    encrypted_regex: '((?i)(pass|secret($|[^N])|ca|crt|key|token|^data$|^stringData$))'
    mac_only_encrypted: true
  # Terraform secret files - Age only
  - path_regex: terraform/.*/.*\.enc\.age\.ya?ml$
    age: age1ha5rkmrmdgd079xkvlp3svelhgd3wxm9l0v88es7hjp6ujcvnyjsxxrc7h
    mac_only_encrypted: true

stores:
  yaml:
    indent: 2
