---
apiVersion: volsync.backube/v1alpha1
kind: ReplicationSource
metadata:
  name: auntalma-media
  namespace: business-system
spec:
  sourcePVC: auntalma-media
  trigger:
    # Daily at 5:00 UTC (16:00 AEDT) - 1 hour after DB backup
    schedule: "0 5 * * *"
  restic:
    # Secret containing RESTIC_REPOSITORY, RESTIC_PASSWORD, and rclone GCS config
    repository: auntalma-media-restic
    # Retention policy: 7 daily, 4 weekly, 3 monthly snapshots
    retain:
      daily: 7
      weekly: 4
      monthly: 3
    # Use Ceph CSI snapshots for consistent backups
    copyMethod: Snapshot
    volumeSnapshotClassName: csi-ceph-filesystem
    # Storage class for temporary snapshot PVC
    storageClassName: ceph-filesystem
    # Cache for faster incremental backups
    cacheStorageClassName: ceph-block
    cacheCapacity: 2Gi
    # Mover pod security context (match Magento's UID/GID)
    moverSecurityContext:
      runAsUser: 1000
      runAsGroup: 1000
      fsGroup: 1000
