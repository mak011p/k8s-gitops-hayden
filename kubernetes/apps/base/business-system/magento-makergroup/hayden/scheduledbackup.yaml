---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/k8s.mariadb.com/backup_v1alpha1.json
apiVersion: k8s.mariadb.com/v1alpha1
kind: Backup
metadata:
  name: hayden-mariadb-weekly
  namespace: business-system
spec:
  mariaDbRef:
    name: hayden-mariadb
  # Weekly backup: Sunday at 05:00 Melbourne time (AEDT)
  # 05:00 AEDT = 18:00 UTC Saturday (UTC+11 in summer)
  schedule:
    cron: "0 18 * * SAT"
    suspend: false
  # Maximum retention period for backups (4 weeks = 672 hours)
  maxRetention: "672h"
  # Storage configuration
  storage:
    # Use S3-compatible storage (GCS)
    s3:
      bucket: hayden-magento2-backups
      prefix: hayden/mariadb
      endpoint: storage.googleapis.com
      region: australia-southeast1
      accessKeyIdSecretKeyRef:
        name: hayden-objstore
        key: accessKeyId
      secretAccessKeySecretKeyRef:
        name: hayden-objstore
        key: secretAccessKey
  # Resources for backup job
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      memory: 512Mi
